---
weight: 1
title: "CVE-2021-21834"
---
# [CVE-2021-21834 - Bad Allocation Chain](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-21834)

### BF Taxonomy

{{< img src="images/CVE-2021-21834.png" height="900" caption="Fig 1. BF for CVE-2021-21834." >}}

<ul>

[DVR](/Classes/_INP/DVR.md) (Verify)

</ul>

{{< rawhtml >}}
<ul><strong>Cause: </strong><cause>Improper Operation
        </cause> - Missing</ul>
    
      <ul><strong>Attributes:</strong>
      
        <ul>Mechanism: <attribute>Range</attribute></ul>
    
      <ul>Source Code: <attribute>Third Party</attribute> (Library box_code_base.c)</ul>
      <ul>Execution Space: <attribute>Local</attribute></ul>
      <ul>Data State: <attribute>Stored</attribute>(“number of entries” read from file)</ul>
    
    
        </ul>
        <ul><strong>Consequence: </strong><consequence>Improper Data Value</consequence> - Inconsistent Value
            ( > max 64-bit int )</ul>
{{< /rawhtml >}}

<ul>

[TCM](/Classes/_DAT/TCM.md) (Calculate)

</ul>

{{< rawhtml >}}
<ul><strong>Cause: </strong><cause>Improper Data Value</cause> - Wrong Argument Value</ul>
      <ul><strong>Attributes: </strong>
        <ul>Mechanism: <attribute>Operator</attribute>(Arithmetic: ‘*’)</ul>
        <ul>Source Code: <attribute>Third Party</attribute> (Library box_code_base.c)</ul>
        <ul>Data Value Kind: <attribute>Numeric</attribute></ul>
        <ul>Data Type Kind: <attribute>Structured</attribute></ul>
    
      </ul>
      <ul><strong>Consequence: </strong><consequence>Improper Data Value</consequence> - Wrap Around </ul>
{{< /rawhtml >}}

<ul>

[MAL](/Classes/_MEM/MAL.md) (Allocate)

</ul>

{{< rawhtml >}}
<ul><strong>Cause: </strong><cause>Improper Data Value</cause> - Wrong Size Used
        (size of memory to allocate</ul>
      <ul><strong>Attributes: </strong>
        <ul>Mechanism: <attribute>Explicit</attribute></ul>
        <ul>Source Code: <attribute>Third Party</attribute> (Library box_code_base.c)</ul>
        <ul>Execution Space: <attribute>Userland</attribute></ul>

        <ul>Ownership: <attribute>Single</attribute></ul>
        <ul>Location: <attribute>Heap</attribute></ul>
    
      </ul>
      <ul><strong>Consequence: </strong><consequence>Improper Object Size</consequence> - Not Enough Memory Allocated </ul>
{{< /rawhtml >}}

<ul>

[MAD](/Classes/_MEM/MAD.md) (Reposition)

</ul>

{{< rawhtml >}}
<ul><strong>Cause: </strong><cause>Improper Object Size</cause> - Not Enough Memory Allocated</ul>
      <ul><strong>Attributes: </strong>
        <ul>Mechanism: <attribute>Sequential</attribute></ul>
        <ul>Source Code: <attribute>Third Party</attribute> (Library box_code_base.c)</ul>
        <ul>Execution Space: <attribute>Userland</attribute></ul>
        <ul>Location: <attribute>Heap</attribute></ul>
    
      </ul>
      <ul><strong>Consequence: </strong><consequence>Improper Data Value</consequence> - Over Bounds Pointer </ul>
{{< /rawhtml >}}

<ul>

[MUS](/Classes/_MEM/MUS.md) (Write)

</ul>

{{< rawhtml >}}
<ul><strong>Cause: </strong><cause>Improper Data Value</cause> - Over Bounds Pointer</ul>
      <ul><strong>Attributes: </strong>
        <ul>Mechanism: <attribute>Sequential</attribute></ul>
        <ul>Source Code: <attribute>Third Party</attribute> (Library box_code_base.c)</ul>
        <ul>Execution Space: <attribute>Userland</attribute></ul>

        <ul>Span: <attribute>Huge</attribute></ul>
        <ul>Location: <attribute>Heap</attribute></ul>
    
      </ul>
      <ul><strong>Consequence: </strong><consequence>Memory Overflow</consequence> - Buffer Overflow </ul>
      <p><h3>BF Description:</h3></p>
          <p><ul>The GPAC Project on Advanced Content is a C language implementation of the MPEG- 4 audio/video compression standard. In version 1.0.1, the library is vulnerable to decoding a specially crafted MPEG-4 input file.</ul></p>
      <p><h3>CVE Description</h3></p>
          <p></p>
    <p>
        <h3>Analysis</h3>
    </p>
    <p>
    <ul>The library code reads the “number of entries” value from a file into a 32-bit integer object (<code>ptr−→nb_entries</code>) and
        checks if it is not larger than the 64- bits input size (<code>ptr−→size/8</code>). Then, the size of memory that should be
        allocated is calculated by multiplying the “number of entries” by the size of a u64 object (<code>sizeof(u64)</code>), which can
        result in an integer overflow on a 32-bit platform. When such an overflowed integer is used, the allocation routine
        will create an undersized buffer, which will be populated based on its larger actual size, leading to a buffer
        overflow. Fig.10 presents the BF taxonomy for this vulnerability.</ul>
    </p>
    <p>
        <h3>The Fix</h3>
    </p>
    <p>
    <ul>To fix the bug, the GPAC team checked the maximum integer size (<code>(u64)ptr−→nb_entries > (u64)SIZE_MAX/sizeof(u64)</code>),
        fixing the DVR bug and resolving the entire vulnerability.</ul>
    </p>

    {{< /rawhtml >}}