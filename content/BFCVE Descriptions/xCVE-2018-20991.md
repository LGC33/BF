---
weight: 1
title: "CVE-2018-20991"
---
# [CVE-2018-20991 - Rust SmallVec Iterator Panic](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-20991)

### BF Taxonomy

{{< img src="images/cve201820991_bug.png" height="200" caption="Fig 1. BF for CVE-2018-20991 â€“ Rust Iterator Panic" >}}

<ul>

[MUS](/Classes/_MEM/MUS.md) (Deallocate)

</ul>

{{< rawhtml >}}
<ul><strong>Cause: </strong><cause>Improper Pointer 
    </cause> - Dangling Pointer (to <code>SmallVec</code>)</ul>

  <ul><strong>Attributes:</strong>
  
    <ul>Mechanism: <attribute>Explicit</attribute></ul>

  <ul>Source Code: <attribute>Standard Library</attribute> (<code>lib.rs</code>)</ul>
  <ul>Execution Space: <attribute>Userland</attribute></ul>

  <ul>Object Ownership: <attribute>Shared</attribute></ul>
  <ul>Object Location: <attribute>Heap</attribute></ul>


    </ul>
    <ul><strong>Consequence: </strong><consequence>Memory Error</consequence> - Double Free</ul>
    
{{< /rawhtml >}}

{{< img src="images/cve201820991_fix.png" height="200" caption="Fig 2. BF for the Bug in the Fix of CVE-2018-20991" >}}

<ul>

[MUS](/Classes/_MEM/MUS.md) (Deallocate)

</ul>

{{< rawhtml >}}
<ul><strong>Cause: </strong><cause>Improper Pointer 
    </cause> - Wrong Sized Used (for <code>SmallVec</code>)</ul>
  <ul><strong>Attributes: </strong>
    <ul>Mechanism: <attribute>Explicit</attribute></ul>

  <ul>Source Code: <attribute>Standard Library</attribute> (<code>lib.rs</code>>)</ul>
  <ul>Execution Space: <attribute>Userland</attribute></ul>

  <ul>Object Ownership: <attribute>Shared</attribute></ul>
  <ul>Object Location: <attribute>Heap</attribute></ul>

  </ul>
  <ul><strong>Consequence: </strong><consequence>Memory Error</consequence> - Memory Leak </ul>
  
  <p><h3>BF Description:</h3></p>
      <p><ul>Rust is a multi-paradigm programming language focused on safe concurrency. It has a similar syntax to C++ and offers features to deal with dynamic memory allocation, such as smart pointers. In general, a Rust programmer does not need to keep track of memory allocation and deallocation, as the language is designed to be memory safe this way.</ul></p>
  <p><h3>CVE Description</h3></p>
      <p></p>
  <p><h3>Analysis</h3></p>
      <p><ul>The versions before Rust 0.6.3 have a bug in the <code>lib.rs</code> file. The <code>insert_many()</code> method in the <code>SmallVec</code> class has two parameters: an iterable <code>I</code> and an <code>index</code>. The method inserts all elements in the iterable <code>I</code> at position <code>index</code>, shifting all the following elements backwards. In the <code>SmallVec</code> class, if an iterator passed to <code>SmallVec::insert_many()</code> panics in <code>Iterator::next</code>, the destructor is called while the vector is in an inconsistent state, possibly causing double free (deallocation via references to same object).</ul></p>
  {{< /rawhtml >}}